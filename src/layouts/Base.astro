---
import "../styles/global.css";
import { site } from "../data/site";

const {
  title = "Cusoon Pools | Pool Cleaning & Repair in Exeter, NH",
  description = "Mobile-first pool cleaning, repairs, and seasonal service in Exeter, NH and nearby towns. Call for fast scheduling and clear water.",
  canonical = "https://cusoon-pools.com/",
} = Astro.props;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  name: site.name,
  telephone: site.phone,
  address: {
    "@type": "PostalAddress",
    addressLocality: "Exeter",
    addressRegion: "NH",
    addressCountry: "US",
  },
  areaServed: site.serviceArea,
  url: "https://cusoon-pools.com/",
};

const emailHref = `mailto:${site.email}?cc=${site.secondaryEmail}`;
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />
    <meta name="theme-color" content="#007ea3" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical} />
    <meta property="og:image" content="https://cusoon-pools.com/cusoon-logo-square-mobile-old.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <script type="application/ld+json">{JSON.stringify(jsonLd)}</script>
  </head>
  <body>
    <header class="sticky top-0 z-50 bg-white/85 backdrop-blur border-b border-sand">
      <div class="container relative flex items-center gap-4 py-2">
        <a href="/" class="flex items-center">
          <picture>
            <source media="(max-width: 639px)" srcset="/cusoon-logo-square-mobile.png" />
            <img src="/cusoon-logo-horizontal-desktop.png" alt="Cusoon Pools logo" class="h-10 w-auto sm:h-12 lg:h-20" />
          </picture>
        </a>
        <nav class="hidden lg:flex items-center gap-8 text-sm font-semibold uppercase tracking-[0.15em]">
          <a href="/services" class="hover:text-sea">Services</a>
          <a href="/blog" class="hover:text-sea">Blog</a>
          <a href="/testimonials" class="hover:text-sea">Testimonials</a>
          <a href="/gallery" class="hover:text-sea">Gallery</a>
          <a href="/get-quotes" class="hover:text-sea">Get Quotes</a>
          <a href="/customer-login" class="hover:text-sea">Customer Login</a>
        </nav>

        <button
          class="lg:hidden ml-auto inline-flex items-center justify-center rounded-full border border-ink/20 px-5 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-ink bg-white/80 backdrop-blur shadow-sm"
          aria-label="Open menu"
          aria-expanded="false"
          data-menu-toggle
        >
          Menu
        </button>

        <div
          class="lg:hidden hidden absolute right-5 top-full mt-3 w-[min(18rem,calc(100vw-2.5rem))] overflow-hidden rounded-2xl border border-sand bg-white shadow-lift"
          data-mobile-menu
        >
          <div class="flex flex-col p-3 text-sm font-semibold uppercase tracking-[0.18em]">
            <a href="/services" class="rounded-xl px-4 py-3 hover:bg-sand/50">Services</a>
            <a href="/blog" class="rounded-xl px-4 py-3 hover:bg-sand/50">Blog</a>
            <a href="/testimonials" class="rounded-xl px-4 py-3 hover:bg-sand/50">Testimonials</a>
            <a href="/gallery" class="rounded-xl px-4 py-3 hover:bg-sand/50">Gallery</a>
            <a href="/get-quotes" class="rounded-xl px-4 py-3 hover:bg-sand/50">Get Quotes</a>
            <a href="/customer-login" class="rounded-xl px-4 py-3 hover:bg-sand/50">Customer Login</a>
          </div>
        </div>
      </div>

      <div class="hidden lg:block border-t border-sand bg-white/75">
        <div class="container flex items-center justify-center gap-3 py-3">
          <a
            href={`tel:${site.tel}`}
            class="inline-flex items-center gap-2 rounded-full border border-sea/25 bg-aqua/25 px-6 py-2.5 text-xs font-semibold uppercase tracking-[0.25em] text-ink shadow-lift hover:bg-aqua/40 hover:border-sea/40 transition"
          >
            <span aria-hidden="true">&#9742;</span>
            <span>Call</span>
          </a>
          <a
            href="/get-quotes"
            class="inline-flex items-center gap-2 rounded-full border border-sea/25 bg-aqua/25 px-6 py-2.5 text-xs font-semibold uppercase tracking-[0.25em] text-ink shadow-lift hover:bg-aqua/40 hover:border-sea/40 transition"
          >
            <span>Get a Quote</span>
          </a>
          <a
            href={emailHref}
            class="inline-flex items-center gap-2 rounded-full border border-sea/25 bg-aqua/25 px-6 py-2.5 text-xs font-semibold uppercase tracking-[0.25em] text-ink shadow-lift hover:bg-aqua/40 hover:border-sea/40 transition"
          >
            <span>Email Us</span>
          </a>
        </div>
      </div>

      <div class="lg:hidden border-t border-sand bg-white/80">
        <div class="container flex items-center justify-center gap-2 py-2">
          <a
            href={`tel:${site.tel}`}
            class="inline-flex items-center gap-2 rounded-full border border-sea/25 bg-aqua/25 px-4 py-2 text-[0.65rem] font-semibold uppercase tracking-[0.18em] text-ink shadow-lift hover:bg-aqua/40 hover:border-sea/40 transition"
          >
            <span aria-hidden="true">&#9742;</span>
            <span>Call</span>
          </a>
          <a
            href="/get-quotes"
            class="inline-flex items-center gap-2 rounded-full border border-sea/25 bg-aqua/25 px-4 py-2 text-[0.65rem] font-semibold uppercase tracking-[0.18em] text-ink shadow-lift hover:bg-aqua/40 hover:border-sea/40 transition"
          >
            <span>Get a Quote</span>
          </a>
          <a
            href={emailHref}
            class="inline-flex items-center gap-2 rounded-full border border-sea/25 bg-aqua/25 px-4 py-2 text-[0.65rem] font-semibold uppercase tracking-[0.18em] text-ink shadow-lift hover:bg-aqua/40 hover:border-sea/40 transition"
          >
            <span>Email Us</span>
          </a>
        </div>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer class="border-t border-sand bg-white">
      <div class="container grid items-center gap-6 py-8 md:grid-cols-[1.1fr_0.9fr]">
        <div class="flex items-center">
          <picture>
            <source media="(max-width: 639px)" srcset="/cusoon-logo-square-mobile.png" />
            <img src="/cusoon-logo-horizontal-desktop.png" alt="Cusoon Pools logo" class="h-10 w-auto sm:h-12" />
          </picture>
        </div>
        <div>
          <p class="text-xs uppercase tracking-[0.2em] text-ink/60">Contact</p>
          <p class="mt-2 font-semibold">{site.phone}</p>
          <p class="text-sm text-ink/70">{site.email}</p>
          <p class="text-sm text-ink/70">{site.location}</p>
          <p class="mt-4 text-xs uppercase tracking-[0.2em] text-ink/60">Service Hours</p>
          <p class="mt-2 text-sm text-ink/70">{site.hours}</p>
        </div>
      </div>
      <div class="border-t border-sand py-4 text-center text-xs text-ink/50">
        &copy; {new Date().getFullYear()} Cusoon Pools. All rights reserved.
      </div>
    </footer>

    <script>
      const toggle = document.querySelector("[data-menu-toggle]");
      const menu = document.querySelector("[data-mobile-menu]");
      if (toggle && menu) {
        const closeMenu = () => {
          menu.classList.add("hidden");
          toggle.setAttribute("aria-expanded", "false");
        };

        toggle.addEventListener("click", () => {
          const willOpen = menu.classList.contains("hidden");
          if (willOpen) {
            menu.classList.remove("hidden");
            toggle.setAttribute("aria-expanded", "true");
          } else {
            closeMenu();
          }
        });

        document.addEventListener("click", (event) => {
          const target = event.target;
          if (!(target instanceof Node)) return;
          if (toggle.contains(target) || menu.contains(target)) return;
          closeMenu();
        });

        document.addEventListener("keydown", (event) => {
          if (event.key === "Escape") closeMenu();
        });
      }
    </script>
  </body>
</html>

