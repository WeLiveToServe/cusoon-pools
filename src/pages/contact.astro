---
import Base from "../layouts/Base.astro";
import { site } from "../data/site";
---
<Base
  title="Contact | Cusoon Pools"
  description="Contact Cusoon Pools for cleaning, repair, or seasonal pool service in Exeter and the Seacoast."
  canonical="https://cusoon-pools.com/contact/"
>
  <section class="pt-6 pb-12">
    <div class="container grid gap-10 lg:grid-cols-[0.95fr_1.05fr] lg:items-center">
      <div class="text-center">
        <p class="text-xs font-medium uppercase tracking-[0.3em] text-ink/60 sm:text-base">Get a Quote</p>
        <p class="mt-0.5 text-sm text-ink/70">(no pressure!)</p>
        {false && <h1 class="mt-6 font-display text-2xl sm:text-3xl">Tell us about your pool.</h1>}
        {false && <p class="mt-4 text-ink/70">
          customer service is our number one priority. We fill follow up with you shortly thereafter, you can also
          just email for general questions about taking care of your own pool. We love talking to people!
        </p>}
      </div>
      <form class="rounded-3xl border border-sand bg-white p-6 shadow-lift" data-quote-form>
        <div class="grid gap-4 sm:grid-cols-2">
          <label class="text-sm">
            Name
            <input
              type="text"
              name="name"
              required
              autocomplete="name"
              placeholder="Your name"
              class="mt-2 w-full rounded-xl border border-ink/20 bg-white px-4 py-3 text-ink placeholder:text-ink/50 focus:border-sea focus:ring-2 focus:ring-aqua/60 focus:outline-none"
            />
          </label>
          <label class="text-sm">
            Email
            <input
              type="email"
              name="email"
              required
              autocomplete="email"
              placeholder="you@email.com"
              class="mt-2 w-full rounded-xl border border-ink/20 bg-white px-4 py-3 text-ink placeholder:text-ink/50 focus:border-sea focus:ring-2 focus:ring-aqua/60 focus:outline-none"
            />
          </label>
        </div>
        <label class="mt-4 block text-sm">
          Phone
          <input
            type="tel"
            name="phone"
            required
            autocomplete="tel"
            placeholder="(603) 555-0000"
            class="mt-2 w-full rounded-xl border border-ink/20 bg-white px-4 py-3 text-ink placeholder:text-ink/50 focus:border-sea focus:ring-2 focus:ring-aqua/60 focus:outline-none"
          />
        </label>
        <div class="mt-6 grid gap-4 sm:grid-cols-2">
          <fieldset class="rounded-2xl border border-sand bg-sand/40 p-4">
            <legend class="px-1 text-sm font-semibold">Type of quote request (optional)</legend>
            <div class="mt-3 space-y-2 text-sm text-ink/80">
              <label class="flex items-center gap-2">
                <input type="checkbox" name="quoteType" value="opening/closing" class="check-input" />
                <span>opening/closing</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="quoteType" value="regular cleaning service" class="check-input" />
                <span>regular cleaning service</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" name="quoteType" value="equipment repairs and maintenance" class="check-input" />
                <span>equipment repairs and maintenance</span>
              </label>
              <label class="flex items-center gap-2">
                <input
                  type="checkbox"
                  name="quoteType"
                  value="structural repair (tile, deck, cover anchors, etc...)"
                  class="check-input"
                />
                <span>structural repair (tile, deck, cover anchors, etc...)</span>
              </label>
            </div>
          </fieldset>
          <fieldset class="rounded-2xl border border-sand bg-sand/40 p-4">
            <legend class="px-1 text-sm font-semibold">How should we get in touch? (optional)</legend>
            <div class="mt-3 space-y-2 text-sm text-ink/80">
              <label class="flex items-center gap-2">
                <input type="radio" name="contactMethod" value="call me" class="check-input" />
                <span>call me</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="contactMethod" value="email me" class="check-input" />
                <span>email me</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="radio" name="contactMethod" value="text me" class="check-input" />
                <span>text me</span>
              </label>
            </div>
          </fieldset>
        </div>
        <button
          type="submit"
          data-quote-submit
          class="mt-6 w-full rounded-full bg-sun px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-ink transition hover:bg-aqua"
        >
          Free Quote
        </button>
        <p class="mt-3 hidden text-xs text-ink/70" data-quote-status></p>
      </form>
    </div>
  </section>
</Base>

<style is:inline>
  .check-input {
    -webkit-appearance: none;
    appearance: none;
    display: grid;
    place-content: center;
    width: 1rem;
    height: 1rem;
    border: 1px solid rgb(12 26 38 / 0.35);
    border-radius: 0.2rem;
    background: #fff;
    cursor: pointer;
  }

  .check-input::after {
    content: "âœ“";
    font-size: 0.95rem;
    font-weight: 800;
    line-height: 1;
    color: rgb(0 0 0);
    transform: scale(0);
    transition: transform 120ms ease-in-out;
  }

  .check-input:checked::after {
    transform: scale(1);
  }

  .check-input:focus-visible {
    outline: 2px solid rgb(96 200 215 / 0.7);
    outline-offset: 2px;
  }
</style>

<script is:inline>
  const quoteForm = document.querySelector("[data-quote-form]");
  const quoteStatus = document.querySelector("[data-quote-status]");
  const quoteSubmit = document.querySelector("[data-quote-submit]");

  if (quoteForm instanceof HTMLFormElement) {
    quoteForm.addEventListener("submit", async (event) => {
      event.preventDefault();
      if (!quoteForm.reportValidity()) return;

      if (quoteSubmit instanceof HTMLButtonElement) {
        quoteSubmit.disabled = true;
      }

      try {
        const response = await fetch("/api/quote", {
          method: "POST",
          body: new FormData(quoteForm),
        });

        if (!response.ok) {
          throw new Error("Quote request failed");
        }

        quoteForm.reset();
        if (quoteStatus instanceof HTMLElement) {
          quoteStatus.textContent = "lorum ipson";
          quoteStatus.classList.remove("hidden");
        }
      } catch (_error) {
        if (quoteStatus instanceof HTMLElement) {
          quoteStatus.textContent = "Unable to submit right now. Please call or email us.";
          quoteStatus.classList.remove("hidden");
        }
      } finally {
        if (quoteSubmit instanceof HTMLButtonElement) {
          quoteSubmit.disabled = false;
        }
      }
    });
  }
</script>
